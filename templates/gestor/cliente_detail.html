{% extends 'gestor/base_gestor.html' %}
{% load static %}

{% block title %}{{ cliente.nome }} | Portal Comercial{% endblock %}

{% block content %}
<div class="card shadow">
  <div class="card-header bg-light d-flex justify-content-between align-items-center">
    <h5 class="card-title mb-0">
      <i class="fas fa-user me-2"></i> {{ cliente.nome }}
    </h5>
    <div>
      <a href="{% url 'gestor:cliente_update' cliente.id %}" class="btn btn-outline-primary btn-sm me-1">
        <i class="fas fa-edit me-1"></i> Editar
      </a>
      <a href="{% url 'gestor:cliente_toggle_status' cliente.id %}" class="btn btn-sm {% if cliente.ativo %}btn-outline-danger{% else %}btn-outline-success{% endif %}">
        <i class="fas {% if cliente.ativo %}fa-ban{% else %}fa-check-circle{% endif %} me-1"></i>
        {% if cliente.ativo %}Desativar{% else %}Ativar{% endif %}
      </a>
      <a href="{% url 'gestor:cliente_list' %}" class="btn btn-outline-secondary btn-sm me-2">
        <i class="fas fa-arrow-left me-1"></i> Voltar
      </a>
    </div>
  </div>

  <div class="card-body">
    <div class="row">
      <!-- COLUNA 1 - Informações do cliente -->
      <div class="col-md-6">
        <div class="card mb-3">
          <div class="card-header bg-light">
            <h6 class="card-title mb-0">Informações Gerais</h6>
          </div>
          <div class="card-body p-0">
            <ul class="list-group list-group-flush">
              <li class="list-group-item"><strong>Código:</strong> {{ cliente.codigo }}</li>
              <li class="list-group-item"><strong>Nome:</strong> {{ cliente.nome }}</li>
              <li class="list-group-item"><strong>Endereço:</strong> {{ cliente.endereco|default:"-" }}</li>
              <li class="list-group-item"><strong>Cidade/UF:</strong> 
                {% if cliente.cidade %}{{ cliente.cidade }}{% if cliente.estado %}/{{ cliente.estado }}{% endif %}
                {% else %}-{% endif %}
              </li>
              <li class="list-group-item"><strong>CEP:</strong> {{ cliente.cep|default:"-" }}</li>
              <li class="list-group-item"><strong>Telefone:</strong> {{ cliente.telefone|default:"-" }}</li>
              <li class="list-group-item"><strong>Email:</strong> {{ cliente.email|default:"-" }}</li>
              <li class="list-group-item"><strong>Data Cadastro:</strong> {{ cliente.data_cadastro|date:"d/m/Y H:i" }}</li>
              <li class="list-group-item">
                <strong>Status:</strong>
                <span class="badge {% if cliente.ativo %}bg-success{% else %}bg-danger{% endif %}">
                  {% if cliente.ativo %}Ativo{% else %}Inativo{% endif %}
                </span>
              </li>
              {% if cliente.observacoes %}
              <li class="list-group-item">
                <strong>Observações:</strong><br>
                {{ cliente.observacoes|linebreaksbr }}
              </li>
              {% endif %}
            </ul>
          </div>
        </div>
      </div>

      <!-- COLUNA 2 - Contatos -->
      <div class="col-md-6">
        <div class="card mb-3">
          <div class="card-header bg-light d-flex justify-content-between align-items-center">
            <h6 class="card-title mb-0">Contatos</h6>
            <a href="{% url 'gestor:cliente_contato_create' cliente.id %}" class="btn btn-primary btn-sm">
              <i class="fas fa-plus me-1"></i> Novo Contato
            </a>
          </div>
          <div class="card-body p-0">
            {% if contatos %}
              <div class="table-responsive">
                <table class="table table-hover mb-0">
                  <thead class="table-light">
                    <tr>
                      <th>Nome</th>
                      <th>WhatsApp</th>
                      <th>Cargo</th>
                      <th class="text-center">Principal</th>
                      <th class="text-end">Ações</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for contato in contatos %}
                      <tr>
                        <td>{{ contato.nome|default:"Não informado" }}</td>
                        <td>{{ contato.whatsapp }}</td>
                        <td>{{ contato.cargo|default:"-" }}</td>
                        <td class="text-center">
                          {% if contato.principal %}
                            <span class="badge bg-primary"><i class="fas fa-check"></i></span>
                          {% endif %}
                        </td>
                        <td class="text-end">
                          <a href="{% url 'gestor:cliente_contato_update' contato.id %}" class="btn btn-sm btn-outline-primary me-1">
                            <i class="fas fa-edit"></i>
                          </a>
                          <a href="{% url 'gestor:cliente_contato_delete' contato.id %}" class="btn btn-sm btn-outline-danger">
                            <i class="fas fa-trash"></i>
                          </a>
                        </td>
                      </tr>
                    {% endfor %}
                  </tbody>
                </table>
              </div>
            {% else %}
              <div class="text-center py-3 text-muted">
                <p class="mb-0">Nenhum contato cadastrado.</p>
              </div>
            {% endif %}
          </div>
        </div>

        <!-- Itens do Cliente (CPF/CNPJ) -->
        <div class="card mb-3">
          <div class="card-header bg-light d-flex justify-content-between align-items-center">
            <h6 class="card-title mb-0">CPF/CNPJ</h6>
            <a href="{% url 'gestor:cliente_item_create' cliente.id %}" class="btn btn-primary btn-sm">
              <i class="fas fa-plus me-1"></i> Novo CPF/CNPJ
            </a>
          </div>
          <div class="card-body p-0">
            {% if itens %}
              <div class="table-responsive">
                <table class="table table-hover mb-0">
                  <thead class="table-light">
                    <tr>
                      <th>Código</th>
                      <th>Tipo</th>
                      <th>CPF/CNPJ</th>
                      <th>Nome/Razão Social</th>
                      <th class="text-center">Status</th>
                      <th class="text-end">Ações</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for item in itens %}
                      <tr>
                        <td>{{ item.codigo }}</td>
                        <td>{{ item.get_tipo_display }}</td>
                        <td>{{ item.cpf_cnpj }}</td>
                        <td>{{ item.nome_razao|default:"-" }}</td>
                        <td class="text-center">
                          <span class="badge {% if item.ativo %}bg-success{% else %}bg-danger{% endif %}">
                            {% if item.ativo %}Ativo{% else %}Inativo{% endif %}
                          </span>
                        </td>
                        <td class="text-end">
                          <a href="{% url 'gestor:cliente_item_update' item.id %}" class="btn btn-sm btn-outline-primary me-1">
                            <i class="fas fa-edit"></i>
                          </a>
                          <a href="{% url 'gestor:cliente_item_delete' item.id %}" class="btn btn-sm btn-outline-danger">
                            <i class="fas fa-trash"></i>
                          </a>
                        </td>
                      </tr>
                    {% endfor %}
                  </tbody>
                </table>
              </div>
            {% else %}
              <div class="text-center py-3 text-muted">
                <p class="mb-0">Nenhum CPF/CNPJ cadastrado.</p>
              </div>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}